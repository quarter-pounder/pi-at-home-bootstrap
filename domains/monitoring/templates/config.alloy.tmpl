// grafana alloy configuration (river language)
logging {
  level = "info"
}

loki "local" {
  endpoint = "http://monitoring-loki:3100"
}

loki.source.docker "containers" {
  host             = "unix:///var/run/docker.sock"
  targets          = docker.containers.targets
  forward_to       = [loki.write.local.receiver]
  keep_file_open   = false
  ignore_older     = "24h"
}

prometheus.exporter.cadvisor "cadvisor" {
  cadvisor_url     = "http://monitoring-cadvisor:8080/metrics"
  scrape_interval  = "15s"
}

prometheus.scrape "cadvisor" {
  targets        = prometheus.exporter.cadvisor.cadvisor.targets
  forward_to     = [prometheus.remote_write.default.receiver]
  scrape_interval = "15s"
}

prometheus.scrape "node" {
  targets        = ["monitoring-node-exporter:9100"]
  forward_to     = [prometheus.remote_write.default.receiver]
  scrape_interval = "15s"
}

prometheus.remote_write "default" {
  endpoint {
    url = "http://monitoring-prometheus:9090/api/v1/write"
  }
}
